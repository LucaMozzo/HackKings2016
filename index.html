<html>
<head>
  <meta charset="utf-8">
  <script src="lib/three.js"></script>
  <script src="lib/leap-0.6.4.js"></script>
  <script src="lib/leap-plugins-0.1.11pre.js"></script>
  <script src="lib/leap-widgets-0.1.0.js"></script>
  <script src="lib/OrbitControls.js"></script>
  <script src="lib/audiosynth.js"></script>

</head>
<body>

</body>

<script>
  'use strict';

  document.body.style.background = '#000'; 

  var piano = Synth.createInstrument('piano');

  // Set up plugins

  Leap.loop({background: true})
    .use('transform', {
      vr: 'desktop' // Switch to meters.
    })
    .use('boneHand', {
      targetEl: document.body,
      jointColor: new THREE.Color(0xffffff),
      rendererOps: {antialias: true}
    })
    .use('proximity');


  // Set up scene

  var scene = Leap.loopController.plugins.boneHand.scene;
  var camera = Leap.loopController.plugins.boneHand.camera;
  var renderer = Leap.loopController.plugins.boneHand.renderer;
  camera.position.set( 0.0, 0.5, 0.3 );

  var controls = new THREE.OrbitControls( camera );

  // Add a plane

  var keys = ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'C']
  var colors = [0x0080ff, 0xff1919, 0xFFFF00, 0x0080ff, 0x00FF00, 0x7D26CD]
  var squares = []
  var buttons = []

  for (var i = -2; i < 3; i++) {
    buttons[i + 2] = createButton(0.09 * i, -0.08, keys[i + 2], 0.05, 0.05, colors[i+3]);
  }

  for (var i = -2; i < 3; i++) {
    squares[i + 2] = createSquares(0.09 * i, 0.4, 0.05, 0.05, colors[i+3]);
  }

  var counter = 0

  var interval = setInterval(function() {
    for (var i = 0; i < squares.length; i++) {
      squares[i].position.set(squares[i].position.x, squares[i].position.y, 0.4 - counter / 100);

      if (squares[i].position.z < buttons[i].position.z) {
        buttons[i] = null
        clearInterval(interval)
      }
    }

    counter++

  }, 50);

  function createButton(xPos, zPos, key, width, height, color) {
    var planeGeo = new THREE.PlaneGeometry(width, width);
    var material = new THREE.MeshPhongMaterial();
    var buttonMesh = new THREE.Mesh(planeGeo, material.clone());

    buttonMesh.name = "rectangular button";

    material.color.setHex(color);

    var longThrow = -0.01;
    var squareButton = new PushButton(

      new InteractablePlane(buttonMesh, Leap.loopController),

      {
        locking: false,
        longThrow: longThrow
      }

    ).on('press', function(mesh){
      piano.play(key, 4, 2); // piano stuff
      mesh.material.color.setHex(0xccccff);

    }).on('release', function(mesh){

      mesh.material.color.setHex(color);

    });

    squareButton.plane.hover(
      function(mesh){ // over
        mesh.material.color.setHex(0xffccff);
      },
      function(mesh){ // out
        mesh.material.color.setHex(color);
      }
    );

    var base = new THREE.Mesh(new THREE.BoxGeometry(width, height, 0.01), new THREE.MeshPhongMaterial({color: color}));
    base.position.set(xPos, 0.12, zPos);
    base.rotateX(Math.PI * -0.5)

    squareButton.plane.resetPosition();

    base.add(buttonMesh);

    scene.add(base);

    return base
  }

  function createSquares(xPos, zPos, width, height, color) {
    var planeGeo = new THREE.PlaneGeometry(width, width);
    var material = new THREE.MeshPhongMaterial();
    var buttonMesh = new THREE.Mesh(planeGeo, material.clone());

    material.color.setHex(color);

    var base = new THREE.Mesh(new THREE.BoxGeometry(width, height, 0.01), new THREE.MeshPhongMaterial({color: color}));
    base.position.set(xPos, 0.12, zPos);
    base.rotateX(Math.PI * -0.5)

    base.add(buttonMesh);

    scene.add(base);

    return base
  }


</script>

</html>